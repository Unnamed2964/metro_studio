# 样式刷工具测试文档

## 功能概述
样式刷工具允许用户快速复制一个对象的样式属性，并将其应用到其他同类型的对象上。

## 快捷键
- **M** - 激活/进入样式刷模式
- **ESC** - 退出样式刷模式

## 支持的样式类型

### 站点样式
- `underConstruction` - 在建状态标记
- `proposed` - 规划状态标记
- **不复制**：名称（nameZh, nameEn）、位置（lngLat, displayPos）

### 线段样式
- `lineStyleOverride` - 线型覆盖（实线/虚线等）
- `isCurved` - 是否曲线
- `waypoints` - 曲线锚点（深度复制）
- `sharedByLineIds` - 所属线路列表
- `openingYear` - 开通年份

### 线路样式
- `color` - 线路颜色
- `status` - 线路状态（运营/在建/规划）
- `style` - 线路样式（实线/虚线/双线等）

## 使用流程

### 方式一：先选中对象，再激活样式刷
1. 在地图上选中一个对象（站点/线段/线路）
2. 按下 **M** 或点击工具栏的样式刷按钮
3. 进入样式刷模式，提示"已拾取XX样式，点击对象应用"
4. 点击其他同类型对象应用样式

### 方式二：先激活样式刷，再拾取样式
1. 按下 **M** 或点击工具栏的样式刷按钮
2. 提示"样式刷模式：请先选中一个对象作为样式源"
3. 点击一个对象拾取其样式
4. 进入样式刷激活状态，可以开始应用样式

## 交互方式

### 单次点击应用
1. 激活样式刷并拾取样式后
2. 点击单个对象应用样式
3. 状态栏显示应用结果

### 批量框选应用
1. 激活样式刷并拾取样式后
2. 按住 **Shift/Ctrl/Meta** 键在地图上拖拽框选
3. 松开鼠标，批量应用样式到框选的所有同类型对象
4. 状态栏显示应用数量

### 退出样式刷
- 点击地图空白区域
- 按下 **ESC** 键
- 切换到其他工具模式

## 限制和规则

### 仅同类型应用
- 站点样式只能应用到站点
- 线段样式只能应用到线段
- 线路样式只能应用到线路
- 尝试跨类型应用会显示警告信息

### 样式替换规则
- **站点**：直接替换状态标记属性
- **线段**：直接替换所有样式属性（线型、曲线、线路、年份）
- **线路**：直接替换所有样式属性（颜色、状态、样式）

### 批量应用优化
- 批量应用时生成单次历史记录
- 批量应用可以撤销/重做
- 只应用到有效的目标对象

## 视觉反馈

### 工具栏
- 样式刷按钮在激活状态下高亮
- 显示当前拾取的样式类型

### 光标样式
- 样式刷激活时光标变为刷子图标（未实现，可后续添加）

### 状态栏
- 拾取样式：显示"已拾取XX样式，点击对象应用"
- 应用成功：显示"已应用样式到XX"
- 应用数量：显示"已应用样式到N个对象"
- 错误提示：显示"只能应用XX样式到XX"

## 测试场景

### 场景1：站点状态标记复制
1. 创建或选中一个在建站点
2. 激活样式刷
3. 点击其他站点应用在建状态
4. 验证目标站点状态已更新
5. 按ESC退出

### 场景2：线段线型批量修改
1. 选中一条虚线线段
2. 激活样式刷
3. Shift+拖拽框选多条实线线段
4. 验证所有选中线段变为虚线
5. 撤销操作验证可回退

### 场景3：线路颜色复制
1. 选中一条红色线路
2. 激活样式刷
3. 点击另一条线路
4. 验证目标线路变为红色

### 场景4：跨类型应用测试
1. 选中站点，激活样式刷
2. 尝试点击线段
3. 验证显示"只能应用站点样式到站点"警告
4. 确认线段样式未改变

### 场景5：批量框选应用
1. 选中一条曲线线段
2. 激活样式刷
3. 框选多条直线线段
4. 验证所有线段变为曲线
5. 状态栏显示应用数量

### 场景6：历史记录测试
1. 应用样式刷
2. 按Ctrl+Z撤销
3. 验证样式已恢复
4. 按Ctrl+Shift+Z重做
5. 验证样式重新应用

## 已知限制

1. **光标图标**：样式刷激活时光标未变化（可在CSS中添加刷子图标）
2. **曲线锚点相对位置**：复制曲线锚点时未考虑目标站点的位置差异（锚点是绝对坐标）
3. **所属线路替换**：线段样式刷会完全替换 `sharedByLineIds`，不是追加

## 后续优化建议

1. 添加光标变化反馈
2. 支持部分属性复制（通过配置对话框选择要复制的属性）
3. 曲线锚点的相对位置调整
4. 样式刷应用前的预览
5. 支持跨类型的智能应用（如从线路颜色应用到线段所属线路）
