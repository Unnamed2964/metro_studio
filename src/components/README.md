# components 目录说明

该目录存放 UI 组件，负责交互与渲染：

- `map-editor/`
  - `MapEditor.vue` 的模块化子目录（图层常量、底图样式、GeoJSON/导出纯函数）
- `ToolbarControls.vue`
  - 侧边栏采用语义化主选项卡（项目与数据 / 绘制流程 / 对象属性 / 发布导出），不增删原功能，仅重构信息架构
  - 侧边栏提供“当前上下文”信息条（编辑模式、对象类型、对象摘要）
  - 支持侧栏收起/展开（状态持久化）
  - 工程管理器（新建、重命名、复制、删除、保存、加载、本地工程检索）
  - OSM 导入参数控制（在建/规划）
  - OSM 导入会新建导入工程并切换，不覆盖当前工程
  - 绘制流程分区：编辑模式切换（选择/点站/AI点站/拉线/连续布线）、选择控制、自动排版参数与触发
  - 对象属性分区：站点重命名、线段信息与删除、线路全属性编辑
  - 站点重命名（单站）与多选模板批量重命名（`{n}` 序号占位）
  - 多选站点支持两种 AI 批量命名：`人工筛选`（复用单站命名逻辑，按站点逐个串行预生成候选后再逐站点选）与 `全自动`（不经人工筛选，自动应用每站首候选，支持取消与失败站点重试，适配几百站规模；全自动启用 strict AI，仅接受模型候选；流程为“上下文并发抓取 + AI 分组批请求”以降低总请求数）
  - 多选两站可手动绑定/解绑换乘关系（用于同名异位站的人工换乘判定）
  - 线路支持一键新增（自动分配与现有线路差异更大的颜色），并可在当前线路面板继续编辑颜色/状态/线型/环线标记
  - 线段编辑（单段详情 + 多选批量属性：迁移所属线 / 线型覆盖 / 曲线直线切换）
  - 提供撤销/重做按钮（与地图快捷键联动）
  - 多选站点统计、全选、批量删除
  - 编辑快捷键提示（Delete/Ctrl+A/Esc）
  - 自动排版触发
  - 自动排版参数滑块：`geoSeedScale`（地理种子缩放，动态生效）
  - 导出实际走向图 PNG、官方风格图 PNG、车辆 HUD ZIP 打包
  - 导出栏车站显示下拉：仅作用于实际走向图（仅换乘站 / 隐藏所有车站 / 显示所有车站）
  - 日间/夜间主题切换（基于 CSS 变量并持久化到 `localStorage`）
  - 全局界面字体切换（思源黑体/苹方/微软雅黑/黑体，基于 `data-ui-font` 并持久化到 `localStorage`）
  - 侧栏头部新增“全球轨道交通长度排名”卡片：显示当前工程总里程、全球名次、与上一名差距（数据源：Wikipedia `List of metro systems`）
- `MapEditor.vue`
  - 基于 MapLibre 的真实地图编辑器
  - OSM 标准瓦片底图（`tile.openstreetmap.org`）
  - 站点点击、拖拽、加点、连线
  - 阶段一网络编辑中的站点标注默认显示中英文双行（无英文时仅显示中文）
  - AI 点站：空白点击后自动新增站点；点击已有站点可直接 AI 复命名。统一抓取周边（默认 `150m`，由 `STATION_NAMING_RADIUS_METERS` 控制）OSM 道路/地域/公共设施/建筑，调用 LLM 基于完整证据集生成命名候选并在鼠标处弹出可点击菜单
  - 连续布线模式：首点后可连续点击自动连线（空白点击会先新增站点再连线）
  - 布线相关点击优先级：拉线/连续布线模式下，站点点击优先于线段点击；若站点与线段命中重叠，将忽略同点线段点击，避免模式被切回“选择/拖拽”导致布线中断
  - 线段支持曲线渲染（仅对手动锚点线段启用，基于锚点样条插值）
  - 线段渲染前会按端点自动校正 `waypoints` 点序方向，避免反向点序导致折线错乱
  - 线段锚点交互（点击选中、拖拽调整、右键新增/删除/清空）
  - 选中线段时会显示其中间锚点（包含导入线段的已有 waypoint）
  - Shift/Ctrl/⌘ 框选支持站点与线段同步选择（支持多选叠加）
  - 线段点击支持多选切换与高亮（高亮层位于线路下方，不覆盖线路主色）
  - 线段/锚点点击支持稳定选中（命中区加宽，并避免被底层地图点击事件立即清空；非选择模式点击会自动切回选择模式）
  - 右键菜单（按点击目标动态出项：空白/站点/线段/锚点，仅保留位置相关编辑动作；空白处支持 AI 在此新增站点，站点支持 AI 命名）
  - 地图视角锁定正北（禁用旋转与俯仰），避免 Ctrl+拖拽与框选冲突
  - 实际走向图 PNG 导出会自动定位到全网范围并隐藏站名后导出；支持按导出设置筛选车站显示（仅换乘站/隐藏全部/显示全部）；完成后恢复当前视角（恢复异常不阻断下载）。启用绘制缓冲保留、内容检测与重试；底图帧不可读时自动回退仅线路层导出；输出导出 trace（控制台 + 状态栏）
  - 比例尺控件（米/公里）
  - 键盘快捷键：删除选中、全选站点、清空选择、撤销/重做（Ctrl/Cmd+Z / Ctrl/Cmd+Shift+Z / Ctrl/Cmd+Y）
  - 渲染线路与站点图层（支持线型：实线/虚线/点线/双线/双虚线/双方点线）
  - 视图容器色板接入全局主题变量，和侧边栏风格统一
- `SchematicView.vue`
  - 渲染自动排版后的官方风示意图
  - 地理主导示意图渲染（保持地理骨架 + 八方向规整）
  - 使用共享渲染模型，输出多状态/多线型线网视觉（无图例、无区名装饰、无标题文字）
  - 支持滚轮缩放与中键平移浏览
  - 画布自适应容器铺满显示
  - 展示评分与快照信息
  - 视图容器色板接入全局主题变量，和侧边栏风格统一
- `VehicleHudView.vue`
  - 车辆 HUD 视图（按线路 + 方向自动生成）
  - 组件顶部提供线路/方向选择控件，支持在阶段三独立切换展示路线
  - 自动计算线路主路径顺序与方向候选
  - 关键 DOM/SVG 节点均提供语义化 class（如 `hud-track__*`、`hud-station__*`），便于 DevTools 定位与定向覆写样式
  - 画布内顶部横条（Logo/线路牌/到达站面板）已移除，仅保留线路轨道与站点主体
  - 自动渲染换乘标识与段间方向箭头
  - 站名锚点整体上移，减轻与轨道贴近感
  - HUD 站点不再绘制终点红色外圈，仅保留线路圆环与换乘标识
  - 换乘站主圆采用加粗外环，并新增内圈（双圈换乘样式）
  - 换乘区文字与线路牌矩形放大显示，三角标使用倒三角并跟随首个换乘线路颜色
  - HUD 纵向高度压缩；非环线短线采用紧凑画布避免元素过小；超长线路按阈值自动单弯折返
  - 环线与部分环线采用双层闭合轨道（上下两层，左右端首尾连接）
  - 支持滚轮缩放与中键平移浏览
  - 视图容器色板接入全局主题变量，和侧边栏风格统一
